<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<div class="container mt-4">
    <div class="card shadow-sm border-0">

        <!-- Header -->
        <div class="card-header bg-primary text-white text-center">
            <h5 class="mb-0 fw-bold">
                <i class="bi bi-train-front me-2"></i>Train Route
            </h5>
        </div>

        <!-- Body -->
        <div class="card-body">

            <!-- Train Select -->
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label fw-semibold">Select Train</label>
                    <select class="form-select" id="trainSelect">
                        <option value="">Select Train</option>
                    </select>
                </div>
            </div>

            <!-- Route List -->
            <div id="TrainRoute">
                <div class="row align-items-center mb-2 routerow">
                    <div class="col-md-6">
                        <input type="text" class="form-control" placeholder="Enter Station Name">
                    </div>
                    <div class="col-md-2 text-end">
                        <button type="button" class="btn btn-outline-danger remove">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="d-flex gap-2 mt-3">
                <button class="btn btn-outline-primary" id="addroute">
                    <i class="bi bi-plus-circle me-1"></i>Add Route
                </button>

                <button class="btn btn-success" id="saveroute">
                    <i class="bi bi-save me-1"></i>Save Route
                </button>
            </div>

        </div>
    </div>
</div>

<style>
    .routerow {
        padding: 8px;
        border-radius: 6px;
        transition: background-color 0.2s;
    }

        .routerow:hover {
            background-color: #f8f9fa;
        }
</style>

<script>
    $(document).ready(function () {

        
        $.ajax({
            url: '/TrainSetup/RouteTrainList', 
            type: 'GET',
            success: function(response) {
                var trains = response.data || response;
                $('#trainSelect').html('<option value="">Select Train</option>' +
                    trains.map(t => `<option value="${t.trainId}">${t.trainName}</option>`).join(''));
            },
            error: function(xhr) {
                console.error('Error loading trains:', xhr);
            }
        });

        
        $('#trainSelect').on('change', function() {
            console.log('Selected train:', $(this).val());
        });

       
        $('#addroute').click(function () {
            $('#TrainRoute').append(`
                <div class="row align-items-center mb-2 routerow">
                    <div class="col-md-6">
                        <input type="text" class="form-control" placeholder="Enter Station Name">
                    </div>
                    <div class="col-md-2 text-end">
                        <button type="button" class="btn btn-outline-danger remove">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `);
        });

        
        $(document).on('click', '.remove', function () {
            $(this).closest('.routerow').remove();
        });


        $('#saveroute').click(function(){

          var trainId=$('#trainSelect').val();

          if(trainId ===""){
              alert("Please select train")
              return;
          }

          var routeList=[];
          
          $('#TrainRoute .routerow').each(function(){
              var stations=$(this).find('input').val().trim();

              if(stations !==""){
                  routeList.push({
                     stations:stations
                  });
              }
          });

          console.log(routeList);

        if (routeList.length === 0) {
        alert("Please add at least one station");
        return;
        }

        $.ajax({
             url: '/TrainSetup/AddRoute',
            type: 'POST',
            data: {
                 trainId: trainId,
                 routeList: JSON.stringify(routeList)

                  
              },
           
             success:function(response){
                alert("route add successfully")
                window.location.href = '/TrainSetup/TrainRoute';
            }
            
        })
        
        })
  

    });
</script>
